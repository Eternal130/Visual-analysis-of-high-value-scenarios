<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scatter Plot with Timeline</title>
    <!-- 引入 ECharts 库 -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.2.1/dist/echarts.min.js"></script>
</head>
<style>
    /* 隐藏时间轴 */
    .echarts-timeline {
        display: none;
    }
</style>
<body>
<!-- 散点图容器 -->
<div id="scatter-chart" style="width: 800px; height: 600px;"></div>

<script>
    // 初始化散点图
    var chart = echarts.init(document.getElementById('scatter-chart'));


    // 绑定鼠标移动事件监听器
    chart.getZr().on('mousemove', function (params) {
        // 获取鼠标相对于图表容器的位置
        var pointInPixel = [params.offsetX, params.offsetY];

        // 将像素坐标转换为数据坐标
        var pointInGrid = chart.convertFromPixel('grid', pointInPixel);

        // 输出鼠标在图表上的位置
        //console.log('Mouse position on chart:', pointInGrid);
    });


    // 绑定鼠标点击事件监听器
    chart.getZr().on('click', function (params) {

        fetch("crosswalkroad10.geojson")
            .then(response => response.json())
            .then(data => {
                console.log(data); // 输出 GeoJSON 数据到控制台
                console.log(1)
                // 在这里可以对数据进行进一步处理或者绘制地图等操作
            })
            .catch(error => {
                console.error('读取文件时出错：', error);
            });


        // 获取鼠标相对于图表容器的位置
        var pointInPixel = [params.offsetX, params.offsetY];

        // 将像素坐标转换为数据坐标
        var pointInGrid = chart.convertFromPixel('grid', pointInPixel);

        // 输出鼠标点击后的位置
        console.log('Mouse click position on chart:', pointInGrid);


        chart.dispatchAction({
            type: 'highlight',
            seriesIndex: 0, // 高亮第一个系列
            dataIndex: 0, // 高亮第一个数据项

        });


        var playState = chart.getModel().getComponent('timeline').getPlayState();

        if (playState === true) {
            chart.dispatchAction({
                type: 'timelinePlayChange',
                // 播放状态，true 为自动播放
                playState: false
            })

            console.log('pause');
        } else if (playState === false) {
            // 如果当前是暂停状态，则点击后播放
            chart.dispatchAction({
                type: 'timelinePlayChange',
                // 播放状态，true 为自动播放
                playState: true
            })
            console.log('play');
        }

    });

    // 初次加载页面时绘制散点图
    drawScatterPlot(getDataByYear(2020));

    // 生成指定年份的示例数据
    function getDataByYear(year) {
        var data = [];
        for (var i = 0; i < 50; i++) {
            var x = Math.random() * 100;
            var y = Math.random() * 100;
            data.push([x, y]);
        }
        return {
            year: year,
            data: data
        };
    }

    // 绘制散点图
    function drawScatterPlot(data) {
        chart.setOption({
            xAxis: {},
            yAxis: {},
            series: [{
                type: 'scatter',
                data: data.data,

                emphasis: {

                    // 设置高亮时的样式
                    itemStyle: {
                        color: 'rgba(255, 0, 0, 0.5)' // 高亮时的颜色
                    }
                }
            }],
            timeline: {
                axisType: 'category',
                data: [2021, 2022, 2023], // 时间轴上的年份
                currentIndex: 0, // 初始年份索引
                //autoPlay: true, // 自动播放
                playInterval: 2000, // 自动播放间隔时间（毫秒）
                loop: true, // 循环播放
                //show:false

            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross'
                }
            },
            options: [
                {
                    series: [{
                        type: 'scatter',
                        data: getDataByYear(2021).data,

                    }]
                },
                {
                    series: [{
                        type: 'scatter',
                        data: getDataByYear(2021).data
                    }]
                },
                {
                    series: [{
                        type: 'scatter',
                        data: getDataByYear(2021).data
                    }]
                }
            ]
        });
    }
</script>
</body>
</html>
