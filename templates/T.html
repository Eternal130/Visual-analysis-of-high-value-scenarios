<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Highlight Effect</title>
    <!-- 引入 ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
    <style>
        /* 设置容器的高度 */
        #chart-container {
            width: 1650px;
            height: 1650px;
        }
    </style>
</head>
<body>
<!-- 创建一个容器来放置图表 -->
<div id="chart-container"></div>
<script>
    var zoom = 3
    var center = [-40, -80]
    // 使用 fetch API 读取 GeoJSON 文件
    const myChart = echarts.init(document.getElementById('chart-container'), 'dark');

    // 定义一个函数，用于加载 GeoJSON 文件并将其注册到 ECharts 中
    function loadGeoJsonAndRegisterMap(filename, mapName) {
        return fetch(`map/${filename}`)
            .then(response => response.json())
            .then(geojsonData => {
                // 将 GeoJSON 数据直接绘制在地图上
                echarts.registerMap(mapName, geojsonData);
            });
    }

    const dataset = [];

    // 定义一个函数,用于加载dataset文件
    function loadDataset() {
        return fetch(`output0.csv`)
            .then(response => response.text())
            .then(data => {
                // 将CSV数据转换为数组
                let rows = data.split('\n');
                for (let row of rows) {
                    dataset.push(row.split(','));
                }
                // 删除第一行,因为第一行是列名
                dataset.shift();
            })
            .catch(error => console.error('Error:', error));
    }
// 在页面打开时加载数据集,因为卡顿影响性能,暂时注释了
    window.onload = function () {
        {#loadDataset();#}
    };

    // 定义一个函数，用于处理加载 GeoJSON 文件时可能出现的错误
    function handleError(error) {
        console.error('Error loading GeoJSON file:', error);
    }

    // 定义一个数组，其中包含了所有需要加载的 GeoJSON 文件的文件名和地图名
    const files = [
        {filename: 'boundaryroad10.geojson', mapName: 'boundaryroadMap'},
        {filename: 'stoplineroad10.geojson', mapName: 'stoplineroad10'},
        {filename: 'crosswalkroad10.geojson', mapName: 'crosswalkroad10'},
        {filename: 'laneroad10.geojson', mapName: 'laneroad10'},
        {filename: 'signalroad10.geojson', mapName: 'signalload10'}
    ];

    // 使用 reduce 方法来串联所有的 Promise，这样就可以按顺序加载所有的 GeoJSON 文件
    files.reduce((promise, file) => {
        return promise
            .then(() => loadGeoJsonAndRegisterMap(file.filename, file.mapName))
            .catch(handleError);
    }, Promise.resolve())
        .then(() => {

            // 当所有的 GeoJSON 文件都加载完成后，设置 ECharts 的配置
            myChart.setOption({
                xAxis: {
                    type: 'value',  // 数值轴
                    name: 'X Axis',  // X轴名称
                    min: -250,  // 最小值
                    max: 250,  // 最大值
                    splitNumber: 50000  // 分割段数
                },
                yAxis: {
                    type: 'value',  // 类目轴
                    name: 'Y Axis',  // Y轴名称
                    min: -250,  // 最小值
                    max: 250,  // 最大值
                    splitNumber: 50000  // 分割段数
                },

                series: [
                    {
                        scaleLimit: {
                            min: 1,  // 最小缩放倍数
                            max: 10   // 最大缩放倍数
                        },
                        center: center,
                        zoom: zoom, // 设置地图缩放级别
                        type: 'map',  // 地图类型为线图
                        coordinateSystem: 'cartesian2d',  // 使用地理坐标系
                        map: 'boundaryroadMap',
                        name: 'stopline',  // 设置系列名称，用于区分
                        roam: 'scale',  // 启用地图的拖动功能
                        itemStyle: {
                            borderColor: 'white', // 设置地图边界的颜色为白色
                            borderWidth: 3,
                            emphasis: {
                                // 高亮时的样式
                                borderWidth: 1,
                                borderColor: 'yellow'
                            }
                        }
                    },
                    {
                        scaleLimit: {
                            min: 1.75 / 3,  // 最小缩放倍数
                            max: 17.5 / 3   // 最大缩放倍数
                        },
                        zoom: 1.75 / 3 * zoom, // 设置地图缩放级别
                        center: center,
                        type: 'map',  // 地图类型为线图
                        coordinateSystem: 'cartesian2d',  // 使用地理坐标系
                        map: 'stoplineroad10',
                        name: 'stopline',  // 设置系列名称，用于区分
                        roam: 'scale',  // 启用地图的拖动功能
                        itemStyle: {
                            borderColor: 'white', // 设置地图边界的颜色为白色
                            borderWidth: 3,
                            emphasis: {
                                // 高亮时的样式
                                borderWidth: 1,
                                borderColor: 'yellow'
                            }
                        }
                    },
                    {
                        scaleLimit: {
                            min: 1.75 / 3,  // 最小缩放倍数
                            max: 17.5 / 3   // 最大缩放倍数
                        },
                        zoom: 1.75 / 3 * zoom, // 设置地图缩放级别
                        center: center,

                        type: 'map',  // 地图类型为线图
                        coordinateSystem: 'cartesian2d',  // 使用地理坐标系
                        map: 'crosswalkroad10',
                        name: 'stopline',  // 设置系列名称，用于区分
                        roam: 'scale',  // 启用地图的拖动功能
                        itemStyle: {
                            borderColor: 'white', // 设置地图边界的颜色为白色
                            borderWidth: 3,
                            emphasis: {
                                // 高亮时的样式
                                borderWidth: 1,
                                borderColor: 'yellow'
                            }
                        }
                    }

                ]
            });
            myChart.on('geoRoam', {geoIndex: 0}, function (params) {
                // 获取当前地图的缩放级别和中心坐标
                var zoomn = params.zoom;

                zoom = zoom * zoomn


                myChart.setOption({

                    series: [
                        {
                            scaleLimit: {
                                min: 1,  // 最小缩放倍数
                                max: 10   // 最大缩放倍数
                            },
                            center: center,
                            zoom: zoom, // 设置地图缩放级别
                            type: 'map',  // 地图类型为线图
                            coordinateSystem: 'cartesian2d',  // 使用地理坐标系
                            map: 'boundaryroadMap',
                            name: 'stopline',  // 设置系列名称，用于区分
                            roam: 'scale',  // 启用地图的拖动功能
                            itemStyle: {
                                borderColor: 'white', // 设置地图边界的颜色为白色
                                borderWidth: 3,
                                emphasis: {
                                    // 高亮时的样式
                                    borderWidth: 1,
                                    borderColor: 'yellow'
                                }
                            }
                        },
                        {
                            scaleLimit: {
                                min: 1.75 / 3,  // 最小缩放倍数
                                max: 17.5 / 3   // 最大缩放倍数
                            },
                            zoom: 1.75 / 3 * zoom, // 设置地图缩放级别
                            center: center,
                            type: 'map',  // 地图类型为线图
                            coordinateSystem: 'cartesian2d',  // 使用地理坐标系
                            map: 'stoplineroad10',
                            name: 'stopline',  // 设置系列名称，用于区分
                            roam: 'scale',  // 启用地图的拖动功能
                            itemStyle: {
                                borderColor: 'white', // 设置地图边界的颜色为白色
                                borderWidth: 3,
                                emphasis: {
                                    // 高亮时的样式
                                    borderWidth: 1,
                                    borderColor: 'yellow'
                                }
                            }
                        },
                        {
                            scaleLimit: {
                                min: 1.75 / 3,  // 最小缩放倍数
                                max: 17.5 / 3   // 最大缩放倍数
                            },
                            zoom: 1.75 / 3 * zoom, // 设置地图缩放级别
                            center: center,

                            type: 'map',  // 地图类型为线图
                            coordinateSystem: 'cartesian2d',  // 使用地理坐标系
                            map: 'crosswalkroad10',
                            name: 'stopline',  // 设置系列名称，用于区分
                            roam: 'scale',  // 启用地图的拖动功能
                            itemStyle: {
                                borderColor: 'white', // 设置地图边界的颜色为白色
                                borderWidth: 3,
                                emphasis: {
                                    // 高亮时的样式
                                    borderWidth: 1,
                                    borderColor: 'yellow'
                                }
                            }
                        }

                    ]
                });
            });


        })
</script>
</body>
</html>